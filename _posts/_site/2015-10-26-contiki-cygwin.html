<p>由于使用 Contiki 需要 Linux 环境，切换来切换去很麻烦，幸好 Windows 下面有 Unix 模拟环境软件，Cygwin。本文主要介绍 8051 核的 Contiki 编译，它的编译需要编译器 SDCC，所以本文介绍 SDCC 的编译。</p>

<!--more-->

<p>官方 8051 核的编译文档请参考 <a href="https://github.com/contiki-os/contiki/wiki/8051-Requirements">8051 Requirements</a>。</p>

<p><em>注：官方的 win32 版的 SDCC 并不适用。</em></p>

<h2 id="section">依赖</h2>

<p>必须确定安装以下依赖包，可以从 Cygwin 源中直接找到：</p>

<blockquote>
  <ul>
    <li>gcc</li>
    <li>flex</li>
    <li>bison</li>
    <li>libboost-graph-dev</li>
    <li>python</li>
    <li>make</li>
    <li>texinfo</li>
  </ul>
</blockquote>

<p>此外，还需要安装一个工具，<a href="http://srecord.sourceforge.net/">srecord</a>，下载 Win32 版本后，直接放于<code class="highlighter-rouge">cygwin/bin/</code>目录下即可。</p>

<h2 id="sdcc">编译 SDCC</h2>

<h3 id="sdcc-">SDCC 源码下载</h3>

<p>直接使用<code class="highlighter-rouge">svn</code>下载即可，本文版本为<strong>9377</strong>：</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>svn co svn://svn.code.sf.net/p/sdcc/code/trunk/sdcc
</code></pre>
</div>

<h3 id="sdcc--1">SDCC 源码修改</h3>

<ul>
  <li>编辑<code class="highlighter-rouge">device/lib/incl.mk</code>，找到：</li>
</ul>

<p><code class="highlighter-rouge">makefile
 MODELS = small medium large
</code></p>

<p>修改成</p>

<p><code class="highlighter-rouge">makefile
 MODELS = small large huge
</code></p>

<ul>
  <li>编译<code class="highlighter-rouge">device/lib/Makefile.in</code>，找到：</li>
</ul>

<p><code class="highlighter-rouge">makefile
 TARGETS += models small-mcs51-stack-auto
</code></p>

<p>修改成：</p>

<p><code class="highlighter-rouge">makefile
 TARGETS += models model-mcs51-stack-auto
</code></p>

<h3 id="section-1">编译</h3>

<p>进行配置：</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>./configure --disable-gbz80-port --disable-z80-port --disable-ds390-port --disable-ds400-port --disable-pic14-port --disable-pic16-port --disable-hc08-port --disable-r2k-port --disable-z180-port --disable-sdcdb --disable-ucsim
</code></pre>
</div>

<p>编译并安装：</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>make
make install
</code></pre>
</div>

<h2 id="section-2">试用</h2>

<p>在 Contiki 的<code class="highlighter-rouge">example/hello-world</code>目录下运行：</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>make <span class="nv">TARGET</span><span class="o">=</span>cc2530dk all
</code></pre>
</div>

<p>便可以生成<code class="highlighter-rouge">hello-world.hex</code>。</p>

<p>用 SmartRF Flash 工具便可以下载。</p>

<h2 id="cc-tool">关于编译 cc-tool</h2>

<p>还是别折腾了，因为 cygwin 下，libusb 不支持。</p>
